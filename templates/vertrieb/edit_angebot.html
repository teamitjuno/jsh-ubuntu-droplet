{% extends 'vertrieb/base.html' %}
{% load static %}
{% load i18n %}
{% load widget_tweaks %}


{% block head %}
<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="utf-8" />
        <title>AngebotsTool | Juno-Solar Administration Tool</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta content="Coderthemes" name="SamIvanov" />
        

        <!-- App favicon -->
        <link rel="shortcut icon" href="{% static 'favicon.ico' %}">
        
        <!-- Theme Config Js -->
        <script src="{% static 'assets/js/hyper-config.js' %}"></script>

        <!-- App css -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <link href="{% static 'assets/css/app-saas.min.css' %}" rel="stylesheet" type="text/css" id="app-style" />
        <link href="{% static 'assets/vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.css' %}" rel="stylesheet" type="text/css" />


        <!-- Icons css -->
        <link href="{% static 'assets/css/icons.min.css' %}" rel="stylesheet" type="text/css" />
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        

    </head>
{% endblock %}

                                        <!-- MAIN CONTAINER & TABS HEAD -->
<!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->
<body>            
            {% block content %}
        
  <div class="content-page">

    <div class="content">


                                                                           <!-- Start Content-->
<div class="container-fluid">     

    {% if form.errors %}
      <div class="alert alert-danger">
        Please correct the following errors:<ul>
          {% for field in form %}
            {% if field.errors %}
              <li>{{ field.label }} - {{ field.errors.0 }}</li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  <div class="row">
    <div class="col-7">
      <div class="page-title-box">
        <h4 class="page-title">Juno Solar Vertriebsportal</h4>
      </div>
    </div>
  </div>

  <form id="main-form" method="POST" onsubmit="updateDisplay();" action="{% url 'vertrieb_interface:edit_angebot' angebot_id=vertrieb_angebot.angebot_id %}">
    {% csrf_token %}
      <div class="row">
        <div class="col-xl-6">
          <div class="card">
            <div class="card-body">
                        {% if not vertrieb_angebot.is_locked %}
                         
                      
              <ul class="nav nav-tabs md-4" role="tablist">
                  <li class="nav-item" role="presentation">
                      <a href="#info" data-bs-toggle="tab" aria-expanded="true" class="nav-link active" aria-selected="true" role="tab">
                          <i class="mdi mdi-home-variant d-md-none d-block"></i>
                          <span class="d-none d-md-block">Info</span>
                      </a>
                  </li>
                  <li class="nav-item" role="presentation">
                      <a href="#wallbox" id="wallbox-tab" data-bs-toggle="tab" aria-expanded="true" class="nav-link " aria-selected="false" tabindex="-1" role="tab">
                          <i class="mdi mdi-account-circle d-md-none d-block"></i>
                          <span class="d-none d-md-block">Wallbox</span>
                      </a>
                  </li>
                  <li class="nav-item" role="presentation">
                      <a href="#module" data-bs-toggle="tab" aria-expanded="true" class="nav-link" aria-selected="false" tabindex="-1" role="tab">
                          <i class="mdi mdi-settings-outline d-md-none d-block"></i>
                          <span class="d-none d-md-block">Module & Zubehör</span>
                      </a>
                  </li>
                  <li class="nav-item" role="presentation">
                    <a href="#ticket" data-bs-toggle="tab" aria-expanded="true" class="nav-link" aria-selected="false" tabindex="-1" role="tab">
                        <i class="mdi mdi-settings-outline d-md-none d-block"></i>
                        <span class="d-none d-md-block">Ticket</span>
                    </a>
                </li>
                <li class="nav-item" role="presentation">
                  <a href="#kalkulationen" data-bs-toggle="tab" aria-expanded="true" class="nav-link " aria-selected="false" tabindex="-1" role="tab">
                      <i class="mdi mdi-account-circle d-md-none d-block"></i>
                      <span class="d-none d-md-block">Kalkulationen</span>
                  </a>
              </li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane show active" id="info" role="presentation">
                <div class="card-body">
                    <div class="row">
                        <!-- Column 1 -->
                        <div class="col-lg-6">
                            <div class="card mb-3">
                              <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">Kundeninfo</div>
                                <div class="card-body">
                                    <table class="table table-sm table-hover">
                                        <tbody>
                                            <tr>
                                                <th>{{ form.anrede.label_tag }}</th>
                                                <td> {{ form.anrede }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.name.label_tag }}</th>
                                                <td>{{ form.name }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.telefon_mobil.label_tag }}</th>
                                                <td>{{ form.telefon_mobil }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.telefon_festnetz.label_tag }}</th>
                                                <td>{{ form.telefon_festnetz }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.email.label_tag }}</th>
                                                <td>{{ form.email }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.firma.label_tag }}</th>
                                                <td>{{ form.firma }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.strasse.label_tag }}</th>
                                                <td>{{ form.strasse }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.ort.label_tag }}</th>
                                                <td>{{ form.ort }}</td>
                                            </tr>
                                            
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- Column 2 -->
                        <div class="col-lg-6">
                            <div class="card mb-3">
                              <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">Auftrag details</div>
                                <div class="card-body">
                                    <table class="table table-sm table-hover">
                                        <tbody>
                                          <tr>
                                            <th>Addresse mit Google Maps öffnen:</th>
                                            <td>
                                                <a href="{{ vertrieb_angebot.google_maps_url }}">die Adresse auf der Karte öffnen</a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>{{ form.anlagenstandort.label_tag }}</th>
                                            <td>{{ form.anlagenstandort }}</td> 
                                        </tr>
                                        <tr>
                                            <th>{{ form.speicher.label_tag }}</th>
                                            <td>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="switch01" {% if form.speicher.value %}checked{% endif %} data-switch="success" name="{{ form.speicher.html_name }}" />
                                                    <label class="custom-control-label" for="switch01" data-on-label="Ja" data-off-label="Nein"></label>
                                                </div>
                                            </td>
                                        </tr>

                                            <tr>
                                                <th>{{ form.anz_speicher.label_tag }}</th>
                                                <td>
                                                <input type="number" id="anz_speicher" class="form-control" name="{{ form.anz_speicher.html_name }}" value="{{ form.anz_speicher.value }}" />
                                                </td>
                                            </tr>
                                            <script>
                                                document.getElementById("yourFormId").addEventListener("submit", function(event){
                                                    // get values from the form
                                                    let speicher = document.getElementById("switch01").checked;
                                                    let anz_speicher = document.getElementById("anz_speicher").value;
                                            
                                                    // perform the validation
                                                    if (speicher && (anz_speicher === null || anz_speicher <= 0)) {
                                                        event.preventDefault(); // prevent form submission
                                                        alert("Die Anzahl der Speicher kann nicht 0 seinwenn speicher inkludet = True.");
                                                    }
                                                });
                                            </script>
                                            
                                            <tr>
                                                <th>{{ form.wallbox.label_tag }}</th>
                                                <td>
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="wallbox-checkbox" {% if form.wallbox.value %}checked{% endif %} data-switch="success" name="{{ form.wallbox.html_name }}" />
                                                        <label class="custom-control-label" for="wallbox-checkbox" data-on-label="Ja" data-off-label="Nein"></label>
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <th>{{ form.komplex.label_tag }}</th>
                                                <td id="komplex" name="komplex">{{ form.komplex }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.angebot_bekommen_am.label_tag }}</th>
                                                <td>{{ vertrieb_angebot.angebot_bekommen_am }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.ablehnungs_grund.label_tag }}</th>
                                                <td> {{ form.ablehnungs_grund }} </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                  <div class="row"> 
                    <div class="col-lg-12">
                      <div class="card mb-3">
                        <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">Notizen</div>
                          <div class="card-body">
                              <table class="table table-sm table-hover">
                                  <tbody>
                                    
                                      <tr>
                                          <th>{{ form.notizen.label_tag }}</th>
                                          <td id="notizen" name="{{ form.notizen.name }}" value="{{ form.notizen.value }}">{{ form.notizen }}</td>
                                      </tr>

                                  </tbody>
                              </table>
                          </div>
                      </div>
                  </div>
                  </div><!-- End of row -->
                </div>

            </div>
              <div class="tab-pane" id="wallbox" role="presentation">
                <div class="card-body">
                 <div class="row"> 
                  <div class="col-lg-6">
                    <div class="card mb-3">
                      <div class="card-header bg-primary p-2 text-white bg-opacity-75 bg-gradient text-white">Wallbox Details</div>
                        <div class="card-body">
                            <table class="table table-sm table-hover">
                                <tr>
                                    <th>{{ form.wallboxtyp.label_tag }}</th>
                                    <td>{{ form.wallboxtyp }}</td>
                                </tr>
                                <tr>
                                    <th>{{ form.wallbox_anzahl.label_tag }}</th>
                                    <td>{{ form.wallbox_anzahl }}</td>
                                </tr>
                                <tr>
                                    <th>{{ form.kabelanschluss.label_tag }}</th>
                                    <td>{{ form.kabelanschluss }}</td>
                                </tr>
                          </table>
                        </div>
                    </div>
                  </div>
                 </div>
                     
                </div>
              </div>
              
             <!-- MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMAMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM -->
               <div class="tab-pane" id="module" role="tabpanel">
                <div class="card-body">
                    <div class="row"> 
                        <div class="col-lg-6">
                            <div class="card mb-3">
                                <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">
                                    Module Details
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm table-hover">
                                        <tr>
                                            <th>{{ form.solar_module.label_tag }}</th>
                                            <td>{{ form.solar_module }}</td>
                                        </tr>
                                        <tr>
                                            <th>{{ form.modulanzahl.label_tag }}</th>
                                            <td id="modulanzahl" name="modulanzahl" data-bs-toggle="tooltip" title="{{ form.modulanzahl.errors }}">
                                                {{ form.modulanzahl }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>{{ form.garantieWR.label_tag }}</th>
                                            <td>{{ form.garantieWR }}</td>
                                        </tr>
                                        <tr>
                                            <th>{{ form.eddi.label_tag }}</th>
                                            <td>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="switch03" {% if form.eddi.value %}checked{% endif %} data-switch="success" name="{{ form.eddi.html_name }}" />
                                                    <label class="custom-control-label" for="switch03" data-on-label="Yes" data-off-label="No"></label>
                                                </div>
                                            </td>
                                        </tr>
                                        
                                        <tr>
                                            <th>{{ form.notstrom.label_tag }}</th>
                                            <td>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="switch04" {% if form.notstrom.value %}checked{% endif %} data-switch="success" name="{{ form.notstrom.html_name }}" />
                                                    <label class="custom-control-label" for="switch04" data-on-label="Yes" data-off-label="No"></label>
                                                </div>
                                            </td>
                                        </tr>
                                        
                                        <tr>
                                            <th>{{ form.anzOptimizer.label_tag }}</th>
                                            <td id="anzOptimizer" name="anzOptimizer" data-bs-toggle="tooltip" title="{{ form.anzOptimizer.errors }}">
                                                {{ form.anzOptimizer }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Modulleistung [Wp]</th>
                                            <td id="modulleistungWp" name="modulleistungWp">{{ vertrieb_angebot.modulleistungWp }}</td>
                                        </tr>
                                        <tr>
                                            <th>Modullsumme [kWp]</th>
                                            <td id="modulsumme_kWp" name="modulsumme_kWp">{{ vertrieb_angebot.modulsumme_kWp }}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                    
                        <div class="col-lg-6">
                          
                            <div class="card mb-3">
                                <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">
                                    Energy Details
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm table-hover">
                                        <tr>
                                            <th>Erzeugte Energie pro Jahr [kWh]</th>
                                            <td>{{ vertrieb_angebot.erzeugte_energie_pro_jahr }} kWh</td>
                                        </tr>
                                        <tr>
                                            <th>Nutzbare PV-Energie [kWh]</th>
                                            <td>{{ vertrieb_angebot.nutzbare_nutzenergie }} kWh</td>
                                        </tr>
                                        <tr>
                                            <th>Benögte Restenegie [kWh]</th>
                                            <td>{{ vertrieb_angebot.benotigte_restenergie }} kWh</td>
                                        </tr>
                                        <tr>
                                            <th>kosten für Restenegie</th>
                                            <td>{{ vertrieb_angebot.kosten_fur_restenergie }} €</td>
                                        </tr>
                                        <tr>
                                            <th>Einspreisevergütung gesamt [€]</th>
                                            <td>{{ vertrieb_angebot.einspreisevergütung_gesamt }} €</td>
                                        </tr>
                                        <tr>
                                            <th>Stromkosten ohne PV-Anlage</th>
                                            <td>{{ vertrieb_angebot.strom_ohne }} €</td>
                                        </tr>
                                        <tr>
                                            <th>Preis abzgl Vergütung und inkl. Restrom</th>
                                            <td>{{ vertrieb_angebot.abzug }} €</td>
                                        </tr>
                                        <tr>
                                            <th>Ersparnis [€]</th>
                                            <td>{{ vertrieb_angebot.ersparnis }} €</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row"> 
                        <div class="col-lg-6">
                            <div class="card mb-3">
                                <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">
                                    Gesamtpreis PV-Anlage (inkl. Monatge)
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm table-hover">
                                        <tr>
                                            <th>Preis Netto</th>
                                            <td>{{ vertrieb_angebot.angebotsumme }} €</td>
                                        </tr>
                                        <tr>
                                            <th>Preis Brutto</th>
                                            <td>{{ vertrieb_angebot.angebotsumme }} €</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
            
                        <!-- Gesamtpreis PV-Anlage for admin -->
                        {% if user.role.name == "admin" %}
                            <div class="col-lg-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary p-2 text-white bg-opacity-75 bg-gradient text-white">
                                        Individual Preis
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm table-hover">
                                            <tr>
                                                <th>{{ form.indiv_price_included.label_tag }}</th>
                                                <td>
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="switch_indiv_price_included" {% if form.indiv_price_included.value %}checked{% endif %} data-switch="success" name="{{ form.indiv_price_included.html_name }}" />
                                                        <label class="custom-control-label" for="switch_indiv_price_included" data-on-label="Yes" data-off-label="No"></label>
                                                    </div>
                                                </td>
                                                
                                            </tr>
                                            <tr id="indiv_price_row">
                                                <th>{{form.indiv_price.label_tag }}</th>
                                                <td>{{ form.indiv_price }}</td>
                                            </tr>
                                        </table>
                                        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
                                        <script type="text/javascript">
                                            $(document).ready(function() {
                                                // Initial state of 'Inddiv Preis' row
                                                updateIndivPreisRow();
                                        
                                                // On 'Indiv Preis inkl.' checkbox state change
                                                $('#switch_indiv_price_included').change(function() {
                                                    updateIndivPreisRow();
                                                });
                                        
                                                function updateIndivPreisRow() {
                                                    if ($('#switch_indiv_price_included').is(':checked')) {
                                                        // If checkbox is checked, show 'Inddiv Preis' row
                                                        $('#indiv_price_row').show();
                                                    } else {
                                                        // If checkbox is not checked, hide 'Inddiv Preis' row
                                                        $('#indiv_price_row').hide();
                                                    }
                                                }
                                            });
                                        </script>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div> 
                    <!-- End of Second Row -->
                </div>
            </div>
            

            
                    
            

              <!-- TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT -->
            <div class="tab-pane" id="ticket" role="presentation">
              <div class="card-body">
                
                  <div class="row">
                      <div class="col-lg-6">
                          <div class="card mb-3">
                              <div class="card-header bg-primary p-2 bg-opacity-50 bg-gradient text-white">Gesamtpreis PV-Anlage (inkl. Monatge)</div>
                              <div class="card-body">
                                  <table class="table table-sm table-hover">
                                      <tbody>
                                          <tr>
                                              <th>{{ form.solar_module.label_tag }}</th>
                                              <td>{{ form.module_ticket }}</td>
                                          </tr>
                                          <tr>
                                              <th>{{ form.modul_anzahl_ticket.label_tag }}</th>
                                              <td>{{ form.modul_anzahl_ticket }}</td>
                                          </tr>
                                      </tbody>
                                  </table>
                              </div>
                          </div>
                      </div>
                      <div class="col-lg-6">
                          <div class="card mb-3">
                              <div class="card-header bg-primary p-2 bg-opacity-75 bg-gradient text-white">Zusätzlich & Abzüge:</div>
                              <div class="card-body">
                                  <table class="table table-sm table-hover">
                                      <tbody>
                                          <tr>
                                              <th>{{ form.optimizer_ticket.label_tag }}</th>
                                              <td>{{ form.optimizer_ticket }}</td>
                                          </tr>
                                          <tr>
                                              <th>{{ form.batteriemodule_ticket.label_tag }}</th>
                                              <td>{{ form.batteriemodule_ticket }}</td>
                                          </tr>
                                          <tr>
                                              <th>{{ form.notstrom_ticket.label_tag }}</th>
                                              <td>{{ form.notstrom_ticket }}</td>
                                          </tr>
                                          <tr>
                                              <th>{{ form.eddi_ticket.label_tag }}</th>
                                              <td>{{ form.eddi_ticket }}</td>
                                          </tr>
                                      </tbody>
                                  </table>
                              </div>
                          </div>
                      </div>
                  </div> <!-- End of row -->
                  {% if vertrieb_angebot.angebot_id_assigned %}
                      <a href="{% url 'vertrieb_interface:create_ticket_pdf' vertrieb_angebot.angebot_id %}" class="btn btn-soft-info">Ticket PDF erstellen</a>
                  {% endif %}
              </div>
          </div>
          <!-- TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT -->
          
          <div class="tab-pane" id="kalkulationen" role="presentation">                       
            <div class="card-body">
                <div class="row">
                    <!-- Column 1 -->
                    <div class="col-lg-6">
                        <div class="card mb-3">
                            <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">Kalkulation Info</div>
                            <div class="card-body">
                                <table class="table table-sm table-hover">
                                    <tbody>
                                        <tr>
                                            <th>{{ form.verbrauch.label_tag }}</th>
                                            <td>{{ form.verbrauch }}</td>
                                        </tr>
                                        <tr>
                                            <th>{{ form.grundpreis.label_tag }}</th>
                                            <td>{{ form.grundpreis }}</td> 
                                        </tr>
                                        <tr>
                                            <th>{{ form.arbeitspreis.label_tag }}</th>
                                            <td id="arbeitspreis" name="arbeitspreis">{{ form.arbeitspreis }}</td>
                                        </tr>
                                        <tr>
                                            <th>{{ form.prognose.label_tag }}</th>
                                            <td>{{ form.prognose }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Column 2 -->
                    <div class="col-lg-6">
                        <div class="card mb-3">
                            <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">Kalkulation Info</div>
                            <div class="card-body">
                                <table class="table table-sm table-hover">
                                    <tbody>
                                        <tr>
                                            <th>{{ form.bis10kWp.label_tag }} </th>
                                            <td>{{ form.bis10kWp }} </td>
                                        </tr>
                                        <tr>
                                            <th>{{ form.bis40kWp.label_tag }} </th>
                                            <td>{{ form.bis40kWp }} </td>
                                        </tr>
                                        <tr>
                                            <th>{{ form.zeitraum.label_tag }}</th>
                                            <td>{{ form.zeitraum }}</td>
                                        </tr>
                                        <tr>
                                            <th>{{ form.ausrichtung.label_tag }}</th>
                                            <td>{{ form.ausrichtung }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% if vertrieb_angebot.angebot_id_assigned %}
                    
                        <a href="{% url 'vertrieb_interface:create_calc_pdf' vertrieb_angebot.angebot_id %}" class="btn btn-soft-info">Kalkulation PDF erstellen</a>
                      {% endif %}
                    </div>
                </div> <!-- End of row -->
            </div>
        </div>
        
            </div>
          {% endif %}


                        <!--- #############################################################################################-->
          {% if vertrieb_angebot.is_locked %}
                <ul class="nav nav-tabs mb-3" role="tablist">
                      <li class="nav-item" role="presentation">
                          <a href="#info" data-bs-toggle="tab" aria-expanded="false" class="nav-link active" aria-selected="true" tabindex="-1" role="tab">
                              <i class="mdi mdi-home-variant d-md-none d-block"></i>
                              <span class="d-none d-md-block">Info</span>
                          </a>
                      </li>
                      <li class="nav-item" role="presentation">
                          <a href="#wallbox" data-bs-toggle="tab" aria-expanded="true" class="nav-link " aria-selected="false" tabindex="-1" role="tab">
                            <i class="mdi mdi-home-variant d-md-none d-block"></i>
                              <span class="d-none d-md-block">Wallbox</span>
                          </a>
                      </li>
                      <li class="nav-item" role="presentation">
                          <a href="#module" data-bs-toggle="tab" aria-expanded="false" class="nav-link" aria-selected="false" tabindex="-1" role="tab">
                                <i class="mdi mdi-home-variant d-md-none d-block"></i>
                              <span class="d-none d-md-block">Module & Zubehör</span>
                          </a>
                      </li>
                      <li class="nav-item" role="presentation">
                        <a href="#ticket" data-bs-toggle="tab" aria-expanded="false" class="nav-link" aria-selected="false" tabindex="-1" role="tab">
                          <i class="mdi mdi-home-variant d-md-none d-block"></i>
                            <span class="d-none d-md-block">Ticket</span>
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                      <a href="#kalkulationen" data-bs-toggle="tab" aria-expanded="true" class="nav-link " aria-selected="false" tabindex="-1" role="tab">
                        <i class="mdi mdi-home-variant d-md-none d-block"></i>
                          <span class="d-none d-md-block">Kalkulationen</span>
                      </a>
                  </li>
              </ul>
              <div class="tab-content">
                <div class="tab-pane show active" id="info" role="tabpanel">
                  <div class="card-body">
                      <div class="row"> <!-- Add row here -->
                          <div class="col-lg-6">
                              <div class="card mb-3">
                                  <div class="card-header bg-primary p-2 text-white bg-opacity-75 bg-gradient text-white">Kunde Info</div>
                                  <div class="card-body">
                                      <table class="table table-sm table-hover">
                                      
                                          
                                          <tr>
                                              <th>{{ form.anrede.label_tag }}</th>
                                              <td><input type="text" class="form-control" name="{{ form.anrede.name }}" value="{{ form.anrede.value }}" readonly></td>
                                          </tr>
                                          <tr>
                                            <th>{{ form.name.label_tag }}</th>
                                            <td><input type="text" class="form-control" name="{{ form.name.name }}" value="{{ form.name.value }}" readonly></td>
                                          </tr>
                                          <tr>
                                            <th>{{ form.telefon_mobil.label_tag }}</th>
                                            <td><input type="text" class="form-control" name="{{ form.telefon_mobil.name }}" value="{{ form.telefon_mobil.value }}" readonly></td>
                                          </tr>
                                          <tr>
                                            <th>{{ form.telefon_festnetz.label_tag }}</th>
                                            <td><input type="text" class="form-control" name="{{ form.telefon_festnetz.name }}" value="{{ form.telefon_festnetz.value }}" readonly></td>
                                          </tr>
                                          <tr>
                                            <th>{{ form.email.label_tag }}</th>
                                            <td><input type="text" class="form-control" name="{{ form.email.name }}" value="{{ form.email.value }}" readonly></td>
                                          </tr>
                                          {% if vertrieb_angebot.firma %}
                                          <tr>
                                            <th>{{ form.firma.label_tag }}</th>
                                            <td><input type="text" class="form-control" name="{{ form.firma.name }}" value="{{ form.firma.value }}" readonly></td>
                                          </tr>
                                          {% endif %}
                                          <tr>
                                            <th>{{ form.strasse.label_tag }}</th>
                                            <td><input type="text" class="form-control" name="{{ form.strasse.name }}" value="{{ form.strasse.value }}" readonly></td>
                                          </tr>
                                          <tr>
                                            <th>{{ form.ort.label_tag }}</th>
                                            <td><input type="text" class="form-control" name="{{ form.ort.name }}" value="{{ form.ort.value }}" readonly></td>
                                          </tr>
                                      
                                        </table>
                                      </div>
                                  </div>
                              </div>
              

                              <div class="col-lg-6"> <!-- Add col-lg-6 here -->
                                <div class="card mb-3">
                                    <div class="card-header bg-primary p-2 text-white bg-opacity-75 bg-gradient text-white">Auftrag Info</div>
                                      <div class="card-body">
                                        <table class="table table-sm table-hover">
                                          <tr>
                                            <th>{{ form.status.label_tag }}</th>
                                            <td><input type="text" class="form-control" name="{{ form.status.name }}" value="{{ form.status.value }}" readonly></td>
                                        </tr>
                                        {% if vertrieb_angebot.status == 'bekommen' %} 
                                        <tr>
                                            <th>Angebotstatus Änderungsdatum:</th>
                                            <td>{{ vertrieb_angebot.status_change_date }}</td>
                                        </tr>
                                        {% endif %}
                                        {% if vertrieb_angebot.status == 'abgelehnt' %} 
                                        <tr>
                                            <th>{{ form.ablehnungs_grund.label_tag }}</th>
                                            <td>{{ vertrieb_angebot.ablehnungs_grund }}</td>
                                        </tr>
                                        {% endif %}
                                      
                                          <tr>
                                              <th> Addrese mit Navigationskarte öffnen: </th>
                                              <td>
                                              <a href="{{ vertrieb_angebot.google_maps_url }}">Adresse auf der Karte anzeigen </a> 
                                              </td>
                                          </tr>
                                          {% if vertrieb_angebot.anlagenstandort %}
                                          <tr>
                                              <th>{{ form.anlagenstandort.label_tag }}</th>
                                              <td>{{ vertrieb_angebot.anlagenstandort }}{{ form.anlagenstandort.errors }}</td>
                                          </tr>
                                          {% endif %}


                                          <tr>
                                            <th>{{ form.anz_speicher.label_tag }}</th>
                                            {% if vertrieb_angebot.anz_speicher == 0 %}
                                            <td><span class="badge bg-danger rounded-pill">Keine</span></td>
                                            
                                            {% else %}
                                            <td> {{ vertrieb_angebot.anz_speicher }}</td>
                                            {% endif %}
                                            <td>
                                          </tr>
                                          <tr>
                                            <th>{{ form.wallbox.label_tag }}</th>
                                            <td hidden>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="wallbox-checkbox" {% if form.wallbox.value %}checked{% endif %} data-switch="success" name="{{ form.wallbox.html_name }}" />
                                                    <label class="custom-control-label" for="wallbox-checkbox" data-on-label="Yes" data-off-label="No"></label>
                                                </div>
                                            </td>
                                            

                                              {% if not vertrieb_angebot.wallbox %}
                                              <td>
                                              <span class="badge bg-danger rounded-pill">Keine</span>
                                              </td>
                                              {% endif %}

                                              {% if  vertrieb_angebot.wallbox %}
                                              <td>
                                              <span class="badge bg-success rounded-pill">Ja</span>
                                              </td>
                                              {% endif %}

                                              
                                          </tr>
                                          <tr>
                                            <th>{{ form.ausrichtung.label_tag }}</th>
                                            
                                            <td><input type="text" id="ausrichtung" class="form-control" name="{{ form.ausrichtung.name }}" value="{{ form.ausrichtung.value }}"  readonly></td>
                                          </tr>
                                          <tr>
                                            <th>{{ form.komplex.label_tag }}</th>
                                            <td><input type="text" class="form-control" name="{{ form.komplex.name }}" value="{{ form.komplex.value }}" readonly></td>
                                          </tr>
                                          <tr>
                                            <th>{{ form.angebot_bekommen_am.label_tag }}</th>
                                            <td>{{ vertrieb_angebot.angebot_bekommen_am }}</td>
                                          </tr>
                                        </table>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="row"> <!-- Add row here -->
                            <div class="col-lg-12">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary p-2 text-white bg-opacity-75 bg-gradient text-white">Notizen</div>
                                    <div class="card-body">
                                        <table class="table table-sm table-hover">
                                          <tr>
                                            <th>{{ form.notizen.label_tag }}</th>
                                            <td id="notizen" name="notizen">{{ vertrieb_angebot.notizen }}</td>
                                          </tr>
                                        </table>
                                      </div>
                                  </div>
                              </div>
                          </div><!-- Close row here -->
                      </div>
                  </div>
                  
                  <div class="tab-pane" id="wallbox" role="presentation">
                    <div class="card-body">
                     <div class="row"> 
                      <div class="col-lg-6">
                        <div class="card mb-3">
                          <div class="card-header bg-primary p-2 text-white bg-opacity-75 bg-gradient text-white">Wallbox Details</div>
                            <div class="card-body">
                                <table class="table table-sm table-hover">
                                    <tr>
                                        <th>{{ form.wallboxtyp.label_tag }}</th>
                                        {% if not vertrieb_angebot.wallbox %}
                                        <td><span class="badge bg-danger rounded-pill">Nicht inklusive</span></td>
                                        {% else %}
                                        <td><input type="text" id="wallboxtyp" class="form-control" name="{{ form.wallboxtyp.name }}" value="{{ form.wallboxtyp.value }}" readonly></td>
                                        {% endif %}
                                    </tr>
                                    <tr>
                                        <th>{{ form.wallbox_anzahl.label_tag }}</th>
                                        {% if not vertrieb_angebot.wallbox %}
                                        <td><span class="badge bg-danger rounded-pill">Nicht inklusive</span></td>
                                        {% else %}
                                        <td><input type="text" id="wallbox_anzahl" class="form-control" name="{{ form.wallbox_anzahl.name }}" value="{{ form.wallbox_anzahl.value }}" readonly></td>
                                        {% endif %}
                                    </tr>
                                    <tr>
                                        <th>{{ form.kabelanschluss.label_tag }}</th>
                                        {% if not vertrieb_angebot.wallbox %}
                                        <td><span class="badge bg-danger rounded-pill">Nicht inklusive</span></td>
                                        {% else %}
                                        <td><input type="text" id="kabelanschluss" class="form-control" name="{{ form.kabelanschluss.name }}" value="{{ form.kabelanschluss.value }}" readonly></td>
                                        {% endif %}
                                    </tr>
                              </table>
                            </div>
                        </div>
                      </div>
                     </div>
                          <!-- Close row here -->
                    </div>
                  </div>
                   
              
                <!-- MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMOOOOOOOOOOOOODULE -->
                
                <div class="tab-pane" id="module" role="tabpanel">
                    <div class="card-body">
                        <div class="row"> 
                            <div class="col-lg-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">
                                        Module Details
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm table-hover">
                                            <tr>
                                                <th>{{ form.solar_module.label_tag }}</th>
                                                {% if user.role.name == "admin" %}
                                                <td> {{ form.solar_module }} </td>
                                                {% else %}
                                                <td><input type="text" id="solar_module" class="form-control" name="{{ form.solar_module.name }}" value="{{ form.solar_module.value }}" readonly></td>
                                                {% endif %}
                                            </tr>
                                            <tr>
                                                <th>{{ form.modulanzahl.label_tag }}</th>
                                                {% if user.role.name == "admin" %}
                                                <td> {{ form.modulanzahl }} </td>
                                                {% else %}
                                                  <td><input type="text" id="modulanzahl" class="form-control" name="{{ form.modulanzahl.name }}" value="{{ form.modulanzahl.value }}" readonly></td>
                                                  {% endif %}
                                            </tr>
                                            <tr>
                                                <th>{{ form.garantieWR.label_tag }}</th>
                                                {% if user.role.name == "admin" %}
                                                <td> {{ form.garantieWR }} </td>
                                                {% else %}
                                                <td><input type="text" id="garantieWR" class="form-control" name="{{ form.garantieWR.name }}" value="{{ form.garantieWR.value }}" readonly></td>
                                                {% endif %}
                                            </tr>
                                            <tr>
                                                <th>{{ form.eddi.label_tag }}</th>
                                                {% if user.role.name == "admin" %}
                                                <td>
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="switch03" {% if form.eddi.value %}checked{% endif %} data-switch="success" name="{{ form.eddi.html_name }}" />
                                                        <label class="custom-control-label" for="switch03" data-on-label="Yes" data-off-label="No"></label>
                                                    </div>
                                                </td>
                                                {% else %}
                                                <td hidden>
                                                  <div class="custom-control custom-switch">
                                                      <input type="checkbox" class="custom-control-input" id="switch03" {% if form.eddi.value %}checked{% endif %} data-switch="success" name="{{ form.eddi.html_name }}" />
                                                      <label class="custom-control-label" for="switch03" data-on-label="Yes" data-off-label="No"></label>
                                                  </div>
                                              </td>
                                                {% if not vertrieb_angebot.eddi %}
                                                <td>
                                                <span class="badge bg-danger rounded-pill">Keine</span>
                                                </td>
                                                {% endif %}
  
                                                {% if  vertrieb_angebot.eddi %}
                                                <td>
                                                <span class="badge bg-success rounded-pill">Ja</span>
                                                </td>
                                                {% endif %}
                                            {% endif %}
                                            </tr>
                                            <tr>
                                                <th>{{ form.notstrom.label_tag }}</th>
                                                <td hidden>
                                                  <div class="custom-control custom-switch">
                                                      <input type="checkbox" class="custom-control-input" id="switch04" {% if form.notstrom.value %}checked{% endif %} data-switch="success" name="{{ form.notstrom.html_name }}" />
                                                      <label class="custom-control-label" for="switch04" data-on-label="Yes" data-off-label="No"></label>
                                                  </div>
                                              </td>
                                                {% if not vertrieb_angebot.notstrom %}
                                                <td>
                                                <span class="badge bg-danger rounded-pill">Keine</span>
                                                </td>
                                                {% endif %}
  
                                                {% if  vertrieb_angebot.notstrom %}
                                                <td>
                                                <span class="badge bg-success rounded-pill">Ja</span>
                                                </td>
                                                {% endif %}
                                            </tr>
                                            <tr>
                                                <th>{{ form.anzOptimizer.label_tag }}</th>
                                                <td><input type="text" id="anzOptimizer" class="form-control" name="{{ form.anzOptimizer.name }}" value="{{ form.anzOptimizer.value }}"></td>
                                            </tr>
                                            <tr>
                                                <th>Modulleistung [Wp]</th>
                                                <td>{{ vertrieb_angebot.modulleistungWp }}</td>
                                            </tr>
                                            <tr>
                                                <th>Modullsumme [kWp]</th>
                                                <td>{{ vertrieb_angebot.modulsumme_kWp }}</td>
                                            </tr>
                                          </table>
                                    </div>
                                </div>
                            </div>
                            
                        
                            <div class="col-lg-6">
                              
                                <div class="card mb-3">
                                    <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">
                                        Energy Details
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm table-hover">
                                            <tr>
                                                <th>Erzeugte Energie pro Jahr [kWh]</th>
                                                <td>{{ vertrieb_angebot.erzeugte_energie_pro_jahr }} kWh</td>
                                            </tr>
                                            <tr>
                                                <th>Nutzbare PV-Energie [kWh]</th>
                                                <td>{{ vertrieb_angebot.nutzbare_nutzenergie }} kWh</td>
                                            </tr>
                                            <tr>
                                                <th>Benögte Restenegie [kWh]</th>
                                                <td>{{ vertrieb_angebot.benotigte_restenergie }} kWh</td>
                                            </tr>
                                            <tr>
                                                <th>kosten für Restenegie</th>
                                                <td>{{ vertrieb_angebot.kosten_fur_restenergie }} €</td>
                                            </tr>
                                            <tr>
                                                <th>Einspreisevergütung gesamt [€]</th>
                                                <td>{{ vertrieb_angebot.einspreisevergütung_gesamt }} €</td>
                                            </tr>
                                            <tr>
                                                <th>Stromkosten ohne PV-Anlage</th>
                                                <td>{{ vertrieb_angebot.strom_ohne }} €</td>
                                            </tr>
                                            <tr>
                                                <th>Preis abzgl Vergütung und inkl. Restrom</th>
                                                <td>{{ vertrieb_angebot.abzug }} €</td>
                                            </tr>
                                            <tr>
                                                <th>Ersparnis [€]</th>
                                                <td>{{ vertrieb_angebot.ersparnis }} €</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                        <div class="row"> 
                            <div class="col-lg-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary p-2 text-white bg-opacity-50 bg-gradient text-white">
                                        Gesamtpreis PV-Anlage (inkl. Monatge)
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm table-hover">
                                            <tr>
                                                <th>Preis Netto</th>
                                                <td>{{ vertrieb_angebot.angebotsumme }} €</td>
                                            </tr>
                                            <tr>
                                                <th>Preis Brutto</th>
                                                <td>{{ vertrieb_angebot.angebotsumme }} €</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                
                            {% if user.role.name == "admin" %}
                                <div class="col-lg-6">
                                    <div class="card mb-3">
                                        <div class="card-header bg-primary p-2 text-white bg-opacity-75 bg-gradient text-white">
                                            Individual Preis
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-sm table-hover">
                                                <tr>
                                                    <th>{{ form.indiv_price_included.label_tag }}</th>
                                                    <td>
                                                        <div class="custom-control custom-switch">
                                                            <input type="checkbox" class="custom-control-input" id="switch_indiv_price_included" {% if form.indiv_price_included.value %}checked{% endif %} data-switch="success" name="{{ form.indiv_price_included.html_name }}" />
                                                            <label class="custom-control-label" for="switch_indiv_price_included" data-on-label="Yes" data-off-label="No"></label>
                                                        </div>
                                                    </td>
                                                    
                                                </tr>
                                                <tr id="indiv_price_row">
                                                    <th>{{form.indiv_price.label_tag }}</th>
                                                    <td>{{ form.indiv_price }}</td>
                                                </tr>
                                            </table>
                                            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
                                            <script type="text/javascript">
                                                $(document).ready(function() {
                                                    // Initial state of 'Inddiv Preis' row
                                                    updateIndivPreisRow();
                                            
                                                    // On 'Indiv Preis inkl.' checkbox state change
                                                    $('#switch_indiv_price_included').change(function() {
                                                        updateIndivPreisRow();
                                                    });
                                            
                                                    function updateIndivPreisRow() {
                                                        if ($('#switch_indiv_price_included').is(':checked')) {
                                                            // If checkbox is checked, show 'Inddiv Preis' row
                                                            $('#indiv_price_row').show();
                                                        } else {
                                                            // If checkbox is not checked, hide 'Inddiv Preis' row
                                                            $('#indiv_price_row').hide();
                                                        }
                                                    }
                                                });
                                            </script>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div> 
                        <!-- End of Second Row -->
                    </div>
                </div>
                <!-- MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMOOOOOOOOOOOOODULE -->
                
               <!-- TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT -->
            <div class="tab-pane" id="ticket" role="presentation">
                <div class="card-body">
                  
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card mb-3">
                                <div class="card-header bg-primary p-2 bg-opacity-50 bg-gradient text-white">Gesamtpreis PV-Anlage (inkl. Monatge)</div>
                                <div class="card-body">
                                    <table class="table table-sm table-hover">
                                        <tbody>
                                            <tr>
                                                <th>{{ form.solar_module.label_tag }}</th>
                                                <td>{{ form.module_ticket }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.modul_anzahl_ticket.label_tag }}</th>
                                                <td>{{ form.modul_anzahl_ticket }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card mb-3">
                                <div class="card-header bg-primary p-2 bg-opacity-75 bg-gradient text-white">Zusätzlich & Abzüge:</div>
                                <div class="card-body">
                                    <table class="table table-sm table-hover">
                                        <tbody>
                                            <tr>
                                                <th>{{ form.optimizer_ticket.label_tag }}</th>
                                                <td>{{ form.optimizer_ticket }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.batteriemodule_ticket.label_tag }}</th>
                                                <td>{{ form.batteriemodule_ticket }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.notstrom_ticket.label_tag }}</th>
                                                <td>{{ form.notstrom_ticket }}</td>
                                            </tr>
                                            <tr>
                                                <th>{{ form.eddi_ticket.label_tag }}</th>
                                                <td>{{ form.eddi_ticket }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div> <!-- End of row -->
                    {% if vertrieb_angebot.angebot_id_assigned %}
                        <a href="{% url 'vertrieb_interface:create_ticket_pdf' vertrieb_angebot.angebot_id %}" class="btn btn-soft-info">Ticket PDF erstellen</a>
                    {% endif %}
                </div>
            </div>
            <!-- TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT -->
            
                
            <div class="tab-pane" id="kalkulationen" role="tabpanel">
              <div class="card-body">
                  <!-- Kalkulationen Details -->
                  <div class="card mb-3">
                      <div class="card-header bg-primary p-2 text-white bg-opacity-75 bg-gradient text-white">Kalkulationen Datei</div>
                      <div class="card-body">
                          <table class="table table-sm table-hover">
                              <thead>
                                  <tr>
                                    <th>{{ form.verbrauch.label_tag }}</th>
                                    <td><input type="text" class="form-control" name="{{ form.verbrauch.name }}" value="{{ form.verbrauch.value }}">{{ form.verbrauch.errors }}</td>
                                    </tr>
                                    <tr>
                                        <th>{{ form.grundpreis.label_tag }}</th>
                                        <td>{{ form.grundpreis }} {{ form.grundpreis.errors }}</td> 
                                    </tr>
                                    <tr>
                                        <th>{{ form.arbeitspreis.label_tag }}</th>
                                        <td id="arbeitspreis" name="arbeitspreis">{{ form.arbeitspreis }} {{ form.arbeitspreis.errors }}</td>
                                    </tr>
                                    <tr>
                                        <th>{{ form.prognose.label_tag }}</th>
                                        <td>{{ form.prognose }}</td>
                                    </tr>
                                    <tr>
                                        <th>{{ form.bis10kWp.label_tag }} </th>
                                        <td>{{ form.bis10kWp }}</td>
                                    </tr>
                                    <tr>
                                        <th>{{ form.bis40kWp.label_tag }} </th>
                                        <td>{{ form.bis40kWp }}</td>
                                    </tr>
                                  <tr>
                                      <th>{{ form.zeitraum.label_tag }}</th>
                                      <td>{{ form.zeitraum }}</td>
                                  </tr>
                                  <tr>
                                      <th>{{ form.ausrichtung.label_tag }}</th>
                                      <td><input type="text" class="form-control" name="{{ form.ausrichtung.name }}" value="{{ form.ausrichtung.value }}"></td>
                                      
                                  </tr>
                              </thead>
                          </table>
                      </div>
                    </div>
                    {% if vertrieb_angebot.angebot_id_assigned %}
                    <a href="{% url 'vertrieb_interface:create_calc_pdf' vertrieb_angebot.angebot_id %}" class="btn btn-soft-info">Kalkulation PDF erstellen</a>
                  {% endif %}
                </div>
              </div>
          
            </div>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="col-xl-4">
          <div class="card">
            <div class="card-body">
                  <p style="font-size: 18px; text-align: left; margin-top: 5px;">Kundennumer: {{ vertrieb_angebot.zoho_kundennumer }}</p>
                  <p style="font-size: 14px; text-align: left; margin-top: 5x;">Termin: {{ vertrieb_angebot.termine_text }}</p>
                  {% if vertrieb_angebot.angebot_id_assigned %}
                  <p style="font-size: 18px; text-align: left; margin-top: 5px;">AngebotID: {{ vertrieb_angebot.angebot_id }}</p>
                  {% else %}
                  <p style="font-size: 18px; text-align: left; margin-top: 5px;">AngebotID:  noch nicht zugeordnet  </p>
                  {% endif %}
                  

                  <p style="font-size: 16px; text-align: left; margin-top: 5px;">{{ vertrieb_angebot.anfrage_vom }}</p>
                  {% if not vertrieb_angebot.is_locked %}
                  <p style="font-size: 16px; text-align: left; margin-top: 5px;">{{ form.status.label_tag}}: {{ form.status }}</p>
                  {% else %}
                  <p style="font-size: 16px; text-align: left; margin-top: 5px;">{{ form.status.label_tag}}:<input type="text" class="form-select" style="width: 300px;" name="{{ form.status.name }}" value="{{ form.status.value }}" readonly></p>
                  {% endif %}
                  
                    {% if vertrieb_angebot.status == 'bekommen' %} 
                    <p style="font-size: 14px; text-align: left; margin-top: 5x;">Angebotstatus Änderungsdatum:</p>
                    <p style="font-size: 14px; text-align: left; margin-top: 5x;">{{ vertrieb_angebot.status_change_date }}</p>
                    {% endif %}
                
                  <p style="font-size: 16px; text-align: left; margin-top: 5px;">Zugriff auf die Bearbeitung: {{ vertrieb_angebot.is_locked|yesno:'Nicht verfügbar,Verfügbar' }}</p>
                
                  <!-- form save-->               <button type="submit" form="main-form" id="save-all-forms" class="btn btn-soft-success">Speichern</button>                 <!-- form save-->     
                  <script>
                    // Your existing getCookie function
                    function getCookie(name) {
                        let cookieValue = null;
                        if (document.cookie && document.cookie !== '') {
                            const cookies = document.cookie.split(';');
                            for (let i = 0; i < cookies.length; i++) {
                                const cookie = cookies[i].trim();
                                // Does this cookie string begin with the name we want?
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }
                
                    // Get the CSRF token
                    const csrftoken = getCookie('csrftoken');
                
                    // Set the CSRF token in the AJAX request headers
                    $.ajaxSetup({
                        headers: { "X-CSRFToken": csrftoken }
                    });
                
                    // Now you can make AJAX requests and they will automatically include the CSRF token
                    // For example:
                    // $.ajax({url: "/my/url/", method: "POST", data: {foo: "bar"}});
                
                </script>
                  <a href="{% url 'vertrieb_interface:pdf_angebots_list_view' %}" class="btn btn-soft-info">PDF Files Liste</a>
                  {% if vertrieb_angebot.angebot_id_assigned %}
                    
                    <a href="{% url 'vertrieb_interface:create_calc_pdf' vertrieb_angebot.angebot_id %}" class="btn btn-soft-info">Kalkulation PDF erstellen</a>
                  {% endif %}
                
                {% if vertrieb_angebot.is_locked %}
                  <a href="{% url 'vertrieb_interface:create_angebot_pdf_user' vertrieb_angebot.angebot_id %}" class="btn btn-soft-info">Angebot PDF erstellen</a>
                {% endif %}
                     
                  
                  
                  

            </div>
          </div>
          <div class="col-sm-10 col-lg-12">
            <div class="card">
              
                <div class="card-body">
                  
                    <h5 class="card-title">Kalkulation Grafik</h5>
                    <img src="{{ MEDIA_URL }}{{ calc_image_suffix }}" class="card-img-top" alt="Kalkulation Grafik ist noch nicht erstellt worden...">
                    
                </div> <!-- end card-body -->
            </div> <!-- end card -->
        </div> <!-- end col-->

        

    </form>
</div>
    </div>
    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6">
                    <script>document.write(new Date().getFullYear())</script> © Juno-Solar Home 
                </div>
                <div class="col-md-6">
                    <div class="text-md-end footer-links d-none d-md-block">
                        <a href="javascript: void(0);">Info</a>
                        <a href="javascript: void(0);">Support</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
  </div>
    

<script src="{% static 'js/vertrieb_interface.js' %}"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>



<script>
    document.addEventListener('DOMContentLoaded', function() {
        const leadstatus = document.getElementById('status');
        const ablehnungs_grund = document.getElementById('ablehnungs_grund');

        // Hide the ablehnungs_grund field by default
        ablehnungs_grund.style.display = 'none';

        leadstatus.addEventListener('change', function() {
            if (this.value === 'abgelehnt') {
                ablehnungs_grund.style.display = 'block';
            } else {
                ablehnungs_grund.style.display = 'none';
            }
        });
    });
</script>
<script>
  function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }
  
  const csrftoken = getCookie('csrftoken');
  
  document.getElementById('save-btn').addEventListener('click', function() {
      fetch('/update_vertrieb_angebot/{{ angebot_id }}/', {
          method: 'POST',
          body: JSON.stringify({
              'verbrauch': document.getElementById('verbrauch-input').value,
              'grundpreis': document.getElementById('grundpreis-input').value,
              'arbeitspreis': document.getElementById('arbeitspreis-input').value,
              'prognose': document.getElementById('prognose-input').value,
              'zeitraum': document.getElementById('zeitraum-input').value,
              'bis10kWp': document.getElementById('bis10kWp-input').value,
              'bis40kWp': document.getElementById('bis40kWp-input').value,
              'ausrichtung': document.getElementById('ausrichtung-input').value
          }),
          headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': csrftoken
          }
      })
      .then(response => response.json())
      .then(data => console.log(data));
  });
  </script>
  
  
<script>
$(document).ready(function() {
    $("#id_name").change(function() {
        var url = "{% url 'vertrieb_interface:vertrieb_autofield' %}";
        var name = $(this).val();

        $.ajax({
            url: url,
            data: {
                'name': name
            },
            success: function(data) {
                // Fill the form fields with data
                $("#id_anrede").val(data.anrede);
                $("#id_strasse").val(data.strasse);
                $("#id_email").val(data.email);
                $("#id_telefon_mobil").val(data.telefon_mobil);
                $("#id_telefon_festnetz").val(data.telefon_festnetz);
                $("#id_ort").val(data.ort);
                $("#id_angebot_bekommen_am").val(data.angebot_bekommen_am);
                $("#id_verbrauch").val(data.verbrauch);
                $("#leadstatus").val(data.leadstatus);
                $("#id_status").val(data.status)
                

                // ... and so on for the rest of your fields
            }
        });
    });
});
</script>
 
{% endblock %}

{% block scripts %}                                        <!-- JS -->

  <script src="{% static 'assets/js/vendor.min.js' %}"></script>
  <script src="{% static 'assets/vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js' %}"></script>

  <!-- Code Highlight js -->
  <script src="{% static 'assets/vendor/highlightjs/highlight.pack.min.js' %}"></script>
  <script src="{% static 'assets/vendor/clipboard/clipboard.min.js' %}"></script>
  <script src="{% static 'assets/js/hyper-syntax.js' %}"></script>

  <script src="{% static 'assets/vendor/apexcharts/apexcharts.min.js' %}"></script>
  <script src="{% static 'assets/vendor/daterangepicker/moment.min.js' %}"></script>
          <!-- Chart.js-->
          <script src="{% static 'assets/vendor/chart.js/chart.min.js' %}"></script>

          <!-- Chart.js Line Demo js -->
          <script src="{% static 'assets/js/pages/demo.chartjs-line.js' %}"></script>  

  <!-- Apex Chart Area Demo js -->
  <script src="https://apexcharts.com/samples/assets/stock-prices.js"></script>
  <script src="https://apexcharts.com/samples/assets/series1000.js"></script>
  <script src="https://apexcharts.com/samples/assets/github-data.js"></script>
  <script src="https://apexcharts.com/samples/assets/irregular-data-series.js"></script>
  <script src="{% static 'assets/js/pages/demo.apex-area.js' %}"></script>  

  <!-- Vector Map js -->
  <script src="{% static 'assets/vendor/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.min.js' %}"></script>
  <script src="{% static 'assets/vendor/admin-resources/jquery.vectormap/maps/jquery-jvectormap-world-mill-en.js' %}"></script>

  <!-- App js -->
  <script src="{% static 'assets/js/app.min.js' %}"></script>
 {% endblock %}
 

</body>
</html>

