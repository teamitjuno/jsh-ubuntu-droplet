{% extends 'vertrieb/base.html'%}
{% load static %}
{% load i18n %}
{% load widget_tweaks %}

{% block content %}
            
            <div class="content-page">
                <div class="content">
                    <form id="saveUserForm" method="post" action="{% url 'adminfeautures:user-update' user.id %}">
                                            {% csrf_token %}
                        <!-- Start Content-->
                        <div class="container-fluid">

                            <!-- start page title -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="page-title-box">
                                        <div class="page-title-right">
                                            <ol class="breadcrumb m-0">
                                                <li class="breadcrumb-item"><a href="javascript: void(0);">Hyper</a></li>
                                                <li class="breadcrumb-item"><a href="javascript: void(0);">Pages</a></li>
                                                <li class="breadcrumb-item active">Profile 2</li>
                                            </ol>
                                        </div>
                                        <h4 class="page-title">Benutzer Einstellungen Menu</h4>
                                    </div>
                                </div>
                            </div>
                            <!-- end page title -->

                            <div class="row">
                                <div class="col-xl-4 col-lg-5">
                                    <div class="card border-info border text-center">
                                        <div class="card-body">
                                            {% if user.avatar %}
                                                <img src="{{ user.avatar.url }}" alt="" class="rounded-circle img-thumbnail">
                                            {% endif %}
                                                {% include './extra/avatar_form.html' %}
                                                            {% comment %} <form action="{% url 'adminfeautures:upload_avatar' user.id %}" method="post" enctype="multipart/form-data" id="myAwesomeDropzone" data-plugin="dropzone" data-previews-container="#file-previews" data-upload-preview-template="#uploadPreviewTemplate">
                                                                {% csrf_token %}
                                                                <div class="fallback">
                                                                    <input type="file" name="avatar" accept="image/*" id="id_avatar">
                                                                </div>

                                                                <div class="dz-message needsclick">
                                                                    <i class="h1 text-muted ri-upload-cloud-2-line"></i>
                                                                    <h3>Drop files here or click to upload.</h3>
                                                                    <span class="text-muted font-13">(This is just a dropzone. Selected files are <strong>not</strong> actually uploaded.)</span>
                                                                </div>
                                                                <button id="submit-all">Upload All Files</button>
                                                            </form>
                                                            <!-- Preview -->
                                                            <div class="dropzone-previews mt-3" id="file-previews"></div>

                                                            <!-- file preview template -->
                                                            <div class="d-none" id="uploadPreviewTemplate">
                                                                <div class="card mt-1 mb-0 shadow-none border">
                                                                    <div class="p-2">
                                                                        <div class="row align-items-center">
                                                                            <div class="col-auto">
                                                                                <img data-dz-thumbnail src="#" class="avatar-sm rounded bg-light" alt="">
                                                                            </div>
                                                                            <div class="col ps-0">
                                                                                <a href="javascript:void(0);" class="text-muted fw-bold" data-dz-name></a>
                                                                                <p class="mb-0" data-dz-size></p>
                                                                            </div>
                                                                            <div class="col-auto">
                                                                                <!-- Button -->
                                                                                <a href="javascript:void(0);" class="btn btn-link btn-lg text-muted" data-dz-remove>
                                                                                    <i class="ri-close-line"></i>
                                                                                </a>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <script>
                                                                // Ensure Dropzone is attached to the form with id "myAwesomeDropzone"
                                                                Dropzone.options.myAwesomeDropzone = {
                                                                    autoProcessQueue: false,
                                                                    init: function() {
                                                                        var submitButton = document.querySelector("#submit-all");
                                                                        myDropzone = this; // reference to this Dropzone instance
                                                                        
                                                                        submitButton.addEventListener("click", function() {
                                                                            myDropzone.processQueue(); // Tell Dropzone to process all queued files.
                                                                        });

                                                                        // You can also listen to other events:
                                                                        this.on("addedfile", function() {
                                                                            // Alert or some logic when a file is added
                                                                        });

                                                                        this.on("complete", function(files) {
                                                                            if (this.getQueuedFiles().length == 0 && this.getUploadingFiles().length == 0) {
                                                                                var _this = this;
                                                                                _this.removeAllFiles();
                                                                            }
                                                                        });
                                                                    }
                                                                };
                                                            </script> {% endcomment %}

                                            <h4 class="mb-0 mt-2">{{ user.first_name }} {{ user.last_name }}</h4>
                                            <p class="text-muted font-14">{{ user.beruf }}</p>
                                            
                                                
                                                    
                                                    {% comment %} <form id="deleteUserForm" method="post" action="{% url 'adminfeautures:user-edit' user.pk %}">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="delete_user" value="true" />
                                                            <input type="hidden" name="user.pk" value="{{ user.pk }}" />
                                                        <script>
                                                            document.getElementById('deleteUserBtn').addEventListener('click', function() {
                                                                if (confirm('Are you sure you want to delete this user?')) {
                                                                    document.getElementById('deleteUserForm').submit();
                                                                    
                                                                } else {
                                                                    console.log('User deletion canceled');
                                                                }
                                                            });
                                                        </script>
                                                            <button type="button" class="btn btn-danger btn-sm mb-4" id="deleteUserBtn">Delete Benutzer</button>
                                                        </form> {% endcomment %}

                                                        <button type="button" class="btn btn-success btn-sm mb-4" id="saveUserBtn">Speichern</button>
                                                                                                                <script>
                                                            document.getElementById('saveUserBtn').addEventListener('click', function() {
                                                                if (confirm('Are you sure you want to save changes for this user?')) {
                                                                    document.getElementById('saveUserForm').submit();
                                                                } else {
                                                                    console.log('User save operation canceled');
                                                                }
                                                            });
                                                        </script>
                                            <div class="text-start mt-3">
                                                
                                                <p class="text-muted mb-2 font-13"><strong>Vor-, Nachname :</strong> <span class="ms-2">{{ user.first_name }} {{ user.last_name }}
                                                        </span></p>

                                                <p class="text-muted mb-2 font-13"><strong>Mobile :</strong><span class="ms-2">{{ user.phone }}</span></p>

                                                <p class="text-muted mb-2 font-13"><strong>Email :</strong> <span class="ms-2 ">{{ user.email }}</span></p>

                                                <p class="text-muted mb-1 font-13"><strong>Location :</strong> <span class="ms-2">Deutschland Sachsen</span></p>
                                            </div>

                                            {% comment %} <ul class="social-list list-inline mt-3 mb-0">
                                                <li class="list-inline-item">
                                                    <a href="javascript: void(0);" class="social-list-item border-primary text-primary"><i
                                                            class="mdi mdi-facebook"></i></a>
                                                </li>
                                                <li class="list-inline-item">
                                                    <a href="javascript: void(0);" class="social-list-item border-danger text-danger"><i
                                                            class="mdi mdi-google"></i></a>
                                                </li>
                                                <li class="list-inline-item">
                                                    <a href="javascript: void(0);" class="social-list-item border-info text-info"><i
                                                            class="mdi mdi-twitter"></i></a>
                                                </li>
                                                <li class="list-inline-item">
                                                    <a href="javascript: void(0);" class="social-list-item border-secondary text-secondary"><i
                                                            class="mdi mdi-github"></i></a>
                                                </li>
                                            </ul> {% endcomment %}
                                        </div> <!-- end card-body -->
                                    </div> <!-- end card -->

                                </div> <!-- end col-->
                                
                                <div class="col-xl-8 col-lg-7">
                                    <div class="card border-primary border">
                                        
                                            <div class="card-body">
                                                <ul class="nav nav-pills bg-nav-pills nav-justified mb-3">
                                                    <li class="nav-item">
                                                        <a href="#daten" data-bs-toggle="tab" aria-expanded="true" class="nav-link rounded-0 active">
                                                            Daten
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="#timeline" data-bs-toggle="tab" aria-expanded="false" class="nav-link rounded-0">
                                                            Andere
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="#aboutme" data-bs-toggle="tab" aria-expanded="false" class="nav-link rounded-0">
                                                            HomeSeite Einstellungen
                                                        </a>
                                                    </li>
                                                </ul>
                                                <div class="tab-content">
                                                    <div class="tab-pane show active" id="daten">
                                                        <div class="border border-light rounded p-2 mb-3">
                                                            <h5 class="mb-3 text-uppercase bg-light p-2 text-info"><i class="mdi mdi-account-circle me-1"></i>Persönliche Info</h5>
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.username.id_for_label }}" class="form-label">Username</label>
                                                                        {{ form.username }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.first_name.id_for_label }}" class="form-label">Vorname</label>
                                                                        {{ form.first_name }}
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.last_name.id_for_label }}" class="form-label">Nachname</label>
                                                                        {{ form.last_name }}
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.email.id_for_label }}" class="form-label">Email Addresse</label>
                                                                        {{ form.email }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.kuerzel.id_for_label }}" class="form-label">Kuerzel</label>
                                                                        {{ form.kuerzel }}
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.phone.id_for_label }}" class="form-label">Mobile Tel Nummer</label>
                                                                        {{ form.phone }}
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.password.id_for_label }}" class="form-label">Passworte</label>
                                                                        <div class="text-info">{{ form.password }}
                                                                        <span class="form-text text-muted">
                                                                            <small>Wenn Sie Ihr Passwort ändern möchten, wenden Sie sich bitte an <a href="{% url 'adminfeautures:change_password' user.pk %}">klicken Sie bitte hier</a>.</small>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                        <div class="border border-light rounded p-2 mb-3">
                                                            <h5 class="mb-3 text-uppercase bg-light p-2 text-info"><i class="mdi mdi-office-building me-1"></i>Benutzerdetails</h5>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.role.id_for_label }}" class="form-label">Benutzerrolle</label>
                                                                        {{ form.role }}
                                                                        <span class="form-text text-muted">
                                                                            <small class="text-warning">Achten Sie darauf, die Benutzerrolle zu wählen! Dies ist für den korrekten Betrieb des AngebotsTools erforderlich.</small>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.beruf.id_for_label }}" class="form-label">Beruf</label>
                                                                        {{ form.beruf }}
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.users_aufschlag.id_for_label }}" class="form-label">Aufschlag</label>
                                                                        {{ form.users_aufschlag }}
                                                                    </div>
                                                                </div>
                                                                    <div class="col-md-4">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.typ.id_for_label }}" class="form-label">Typ</label>
                                                                        {{ form.typ }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="border border-light rounded p-2 mb-3">
                                                            <h5 class="mb-3 text-uppercase bg-light p-2 text-info"><i class="mdi mdi-earth me-1"></i> Andere Daten</h5>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.age.id_for_label }}" class="form-label">Age</label>
                                                                        {{ form.age }}
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.gerat.id_for_label }}" class="form-label">Mobile Gerät</label>
                                                                        {{ form.gerat }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                    
                                                            <div hidden class="row">
                                                                <div class="col-md-6">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.anbieter.id_for_label }}" class="form-label">Anbieter</label>
                                                                        {{ form.anbieter }}
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.google_passwort.id_for_label }}" class="form-label">Google Passwort</label>
                                                                        {{ form.google_passwort }}
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.google_account.id_for_label }}" class="form-label">Google Account</label>
                                                                        {{ form.google_account }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="tab-pane" id="timeline">
                                                        <div class="border border-light rounded p-2 mb-3">
                                                            <h5 class="mb-3 text-uppercase bg-light p-2 text-info"><i class="mdi mdi-earth me-1"></i> SMTP Einstellungen</h5>
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.smtp_server.id_for_label }}" class="form-label">SMTP Server</label>
                                                                        {{ form.smtp_server }}
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.smtp_port.id_for_label }}" class="form-label">SMTP Port</label>
                                                                        {{ form.smtp_port }}
                                                                    </div>
                                                                </div>
                                                            
                                                                <div class="col-md-3">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.smtp_username.id_for_label }}" class="form-label">SMTP username (email)</label>
                                                                        {{ form.smtp_username }}
                                                                    </div>
                                                                </div>
                                                                
                                                                <div class="col-md-3">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.smtp_password.id_for_label }}" class="form-label">SMTP Passwort</label>
                                                                        {{ form.smtp_password }}
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.smtp_subject.id_for_label }}" class="form-label">SMTP Thema</label>
                                                                        {{ form.smtp_subject }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.smtp_body.id_for_label }}" class="form-label">SMTP Body</label>
                                                                        {{ form.smtp_body }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="border border-light rounded p-2 mb-3">
                                                            <h5 class="mb-3 text-uppercase bg-light p-2 text-info"><i class="mdi mdi-earth me-1"></i> DEBUG Fields und Einstellungen</h5>
                                                            <div class="row">
                                                                {% comment %} <div class="col-md-12">
                                                                    <div class="mb-3">
                                                                        <label for="{{ form.zoho_data_text.id_for_label }}" class="form-label">zoho_data_text</label>
                                                                        {{ form.zoho_data_text }}
                                                                    </div>
                                                                </div> {% endcomment %}
                                                            </div>
                                                            
                                                        </div>
                                                    </div>

                                                    <div class="tab-pane" id="aboutme">
                                                        <div class="border border-light rounded p-2 mb-3 text-center">
                                                            <h5 class="card-title text-primary">Anzeige von Containern auf der HOME-Seite</h5>
                                                            <table class="table table-striped">
                                                                <tbody>
                                                                    <tr>
                                                                        <td>Unsere Mitarbeiter</td>
                                                                        <td><input type="checkbox" id="top_verkaufer_container_view" name="{{ form.top_verkaufer_container_view.name }}" {% if form.top_verkaufer_container_view.value %}checked{% endif %} data-switch="info"/><label for="top_verkaufer_container_view" data-on-label="Ja" data-off-label="Nein"></label></td>
                                                                        <td>Anzeige des Containers "Unsere Mitarbeiter"</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Profil</td>
                                                                        <td><input type="checkbox" id="profile_container_view" name="{{ form.profile_container_view.name }}" {% if form.profile_container_view.value %}checked{% endif %} data-switch="info"/><label for="profile_container_view" data-on-label="Ja" data-off-label="Nein"></label></td>
                                                                        <td>Anzeige des Containers "Profil"</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Letzte Aktivitäten</td>
                                                                        <td><input type="checkbox" id="activity_container_view" name="{{ form.activity_container_view.name }}" {% if form.activity_container_view.value %}checked{% endif %} data-switch="info"/><label for="activity_container_view" data-on-label="Ja" data-off-label="Nein"></label></td>
                                                                        <td>Anzeige des Containers "Letzte Aktivitäten"</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Angebotstatus Übersicht</td>
                                                                        <td><input type="checkbox" id="angebot_statusubersicht_view" name="{{ form.angebot_statusubersicht_view.name }}" {% if form.angebot_statusubersicht_view.value %}checked{% endif %} data-switch="info"/><label for="angebot_statusubersicht_view" data-on-label="Ja" data-off-label="Nein"></label></td>
                                                                        <td>Anzeige des Containers "Angebotstatus Übersicht"</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Schnell-PV-Rechner</td>
                                                                        <td><input type="checkbox" id="pv_rechner_view" name="{{ form.pv_rechner_view.name }}" {% if form.pv_rechner_view.value %}checked{% endif %} data-switch="info"/><label for="pv_rechner_view" data-on-label="Ja" data-off-label="Nein"></label></td>
                                                                        <td>Anzeige des Containers "Schnell-PV-Rechner"</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Anzahl der verkauften Solarmodule</td>
                                                                        <td><input type="checkbox" id="anzahl_sol_module_view" name="{{ form.anzahl_sol_module_view.name }}" {% if form.anzahl_sol_module_view.value %}checked{% endif %} data-switch="info"/><label for="anzahl_sol_module_view" data-on-label="Ja" data-off-label="Nein"></label></td>
                                                                        <td>Anzeige des Containers "Anzahl der verkauften Solarmodule"</td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        
                                    </div> <!-- end tab-content -->
                                </div> <!-- end card body -->
                            </div> <!-- end card -->
                        </div>
                    </form> <!-- end col -->
                </div>
                        <!-- end row-->

            </div>
                    <!-- container -->

        </div>
                <!-- content -->

                <!-- Footer Start -->
                <footer class="footer">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-6">
                                <script>document.write(new Date().getFullYear())</script> © Juno-Solar Home 
                            </div>
                            <div class="col-md-6">
                                <div class="text-md-end footer-links d-none d-md-block">
                                    <a type="submit" href="javascript:void(0)" id="send_support_message">Support</a>
                                    <div class="d-print-none mt-4">
                                        <div class="text-end">
                                            <div id="success-alert-modal_2" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
                                                <div class="modal-dialog modal-sm">
                                                    <div class="modal-content modal-filled bg-success">
                                                        <div class="modal-body p-4">
                                                            <div class="text-center">
                                                                <i class="ri-check-line h1"></i>
                                                                <h4 class="mt-2">Gut gemacht!</h4>
                                                                <p class="mt-3">Email support message wurde erfolgreich versendet!</p>
                                                                <button type="button" class="btn btn-light my-2" data-bs-dismiss="modal">Weiter</button>
                                                            </div>
                                                        </div>
                                                    </div><!-- /.modal-content -->
                                                </div><!-- /.modal-dialog -->
                                            </div>
                                            <script>
                                                function getCookie(name) {
                                                    let cookieValue = null;
                                                    if (document.cookie && document.cookie !== '') {
                                                        const cookies = document.cookie.split(';');
                                                        for (let i = 0; i < cookies.length; i++) {
                                                            const cookie = cookies[i].trim();
                                                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                                                break;
                                                            }
                                                        }
                                                    }
                                                    return cookieValue;
                                                }

                                                document.getElementById('send_support_message').addEventListener('click', function() {
                                                    var csrfToken = getCookie('csrftoken'); 
                                                    fetch('{% url 'vertrieb_interface:send_support_message' %}', {
                                                        method: 'POST',
                                                        headers: {
                                                            'Content-Type': 'application/json',
                                                            'X-CSRFToken': csrfToken
                                                        },
                                                        body: JSON.stringify({})
                                                    })
                                                    .then(response => response.json())
                                                    .then(data => {
                                                        console.log(data);
                                                        if (data.status === 'success') {
                                                            $('#success-alert-modal_2').modal('show');
                                                        }
                                                    });
                                                });
                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </footer>
                <!-- end Footer -->
    </div>

{% endblock %}

{% block extra_js %}
    <!-- Vendor js -->
    <script src="{% static 'assets/js/vendor.min.js' %}"></script>

    <!-- Chart.js -->
    <script src="{% static 'assets/vendor/chart.js/chart.min.js' %}"></script>

    <!-- Profile Demo App js -->
    <script src="{% static 'assets/js/pages/demo.profile.js' %}"></script>

    <!-- App js -->
    <script src="{% static 'assets/js/app.min.js' %}"></script>
{% endblock %}